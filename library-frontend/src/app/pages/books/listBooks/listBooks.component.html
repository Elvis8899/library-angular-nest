<section class="main-container">
  <h2 translate style="display: flex; justify-content: space-between">
    Books List
    <button class="" (click)="goToAddBook()" type="submit" translate>
      {{ "Create Book" }}
    </button>
  </h2>

  <div>
    <div class="toolbar">
      <mat-form-field class="name-form">
        <mat-icon matPrefix>search</mat-icon>
        <input
          (input)="data.queryBy({ name: $event.value })"
          matInput
          placeholder="Search"
        />
      </mat-form-field>
      <mat-form-field class="created-at-form">
        <input
          (dateChange)="data.queryBy({ createdAt: $event.value })"
          matInput
          [matDatepicker]="picker"
          placeholder="Created At"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="property-form" disabled>
        <mat-label>Order by</mat-label>
        <mat-select
          disabled
          value="createdAt"
          (selectionChange)="data.sortBy({ property: $event.value })"
        >
          <mat-option value="name">name</mat-option>
          <mat-option value="createdAt">createdAt</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-button-toggle-group
        value="desc"
        (change)="data.sortBy({ order: $event.value })"
        disabled
      >
        <mat-button-toggle value="asc"
          ><mat-icon>arrow_upward</mat-icon></mat-button-toggle
        >
        <mat-button-toggle value="desc"
          ><mat-icon>arrow_downward</mat-icon></mat-button-toggle
        >
      </mat-button-toggle-group>
      @if (data.loading$ | async) {
        <mat-spinner diameter="32" />
      }
    </div>
    <table mat-table [dataSource]="data" class="mat-elevation-z1">
      <ng-container matColumnDef="image">
        <th mat-header-cell *matHeaderCellDef>Imagem</th>
        <td mat-cell *matCellDef="let book">
          <img [src]="book.image" alt="{{ book.name }}" />
        </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef translate>Name</th>
        <td mat-cell *matCellDef="let book">{{ book.name }}</td>
      </ng-container>

      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Preço</th>
        <td mat-cell *matCellDef="let book">{{ book.price }}</td>
      </ng-container>

      <ng-container matColumnDef="availability">
        <th mat-header-cell *matHeaderCellDef>Disponibilidade</th>
        <td mat-cell *matCellDef="let book">
          {{ bookAvailabilityRatio(book) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let book">
          <div style="display: flex; justify-content: space-evenly">
            <button
              [disabled]="!isBookAvailable(book)"
              (click)="openRentBookDialog(book)"
            >
              emprestar
            </button>
            @if (isAdmin()) {
              <button (click)="addBookItem(book)">adicionar</button>
              <button (click)="removeBookItem(book)">remover</button>
              <button>deletar</button>
            }
          </div>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    @if (data.page$ | async; as page) {
      <mat-paginator
        [length]="page.count"
        [pageSize]="page.limit"
        [pageIndex]="page.page"
        [pageSizeOptions]="[5, 10, 25, 100]"
        (page)="data.fetch($event.pageIndex)"
      >
      </mat-paginator>
    }
  </div>
</section>
